<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bit.domain.novel">
	<!-- 등록 -->
	<insert id="create">
			<![CDATA[insert all
		into novel(title,n_description,image,ending) values(#{title},#{n_description},#{image},ending)]]>
		<include refid="add" />
	</insert>

	<!-- 열람 -->
	<select id="read" resultMap="AuthorResultMap">
		SELECT * FROM novel WHERE n_id =
		#{n_id}
	</select>

	<!-- 수정 -->
	<update id="update">
		UPDATE novel SET title = #{title}, n_description =
		#{n_description}, image = #{image}, ending = #{ending}
		where n_id =
		#{n_id}
	</update>

	<!-- 삭제 -->
	<delete id="delete">
		DELETE FROM novel WHERE n_id = #{n_id}
	</delete>
	<!-- 목록 -->
	<select id="listAll" resultMap="AuthorResultMap">
		<![CDATA[
		SELECT n_id, title, n_description, image, ending FROM novel where n_id > 0
		ORDER BY n_id DESC
		]]>
	</select>
	<!-- 페이징 -->
	<select id="listPaging" resultMap="AuthorResultMap">
		<![CDATA[
		SELECT n_id, title, n_description, image, ending FROM novel where n_id > 0
		ORDER BY n_id DESC
		LIMIT #{page}, 10
		]]>
	</select>
	<select id="listCriteria" resultMap="AuthorResultMap">
			<![CDATA[
		SELECT n_id, title, n_description, image, ending FROM novel where n_id > 0
		]]>
		<include refid="search" />
		<![CDATA[ORDER BY n_id DESC
		LIMIT #{pageStart}, #{perPageNum}]]>
	</select>
	<!-- 전체 작가 수 -->
	<select id="countAuthors" resultType="int">
			<![CDATA[
		SELECT COUNT(n_id)
		FROM novel
		where n_id > 0
		]]>
		<include refid="search" />
	</select>
	<sql id="add">
		<if test="n_id != null">
			INTO novel_author(n_id, a_id) VALUES(#{n_id},#{a_id})
		</if>
		<if test="p_id != null">
			INTO novel_pub(n_id, p_id) VALUES(#{n_id},#{p_id})
		</if>
		<if test="w_id != null">
			INTO novel_web(n_id, w_id) VALUES(#{n_id},#{w_id})
		</if>

	</sql>
	<sql id="search">
		<if test="keyword != null">
			AND title like concat('%', #{keyword}, '%')
		</if>
	</sql>

	<resultMap id="AuthorResultMap"
		type="com.bit.domain.AuthorVO">
		<id property="n_id" column="n_id" />
		<result property="a_name" column="a_name" />
		<result property="gender" column="gender" />
		<result property="a_history" column="a_history" />
	</resultMap>
</mapper>

